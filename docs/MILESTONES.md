# LabelHub 里程碑交付计划

> 版本：v1.0-MVP  
> 最后更新：2025-12-13  
> 预计总工期：8-10 周

---

## 概览

```
时间线：
Week 0-2    ████████░░░░░░░░░░░░░░░░░░  M0: 基础框架
Week 2-4    ░░░░░░░░████████░░░░░░░░░░  M1: 核心标注功能
Week 4-7    ░░░░░░░░░░░░░░░░████████████  M2: 效率优化
Week 7-9    ░░░░░░░░░░░░░░░░░░░░░░░░████  M3: 统计与完善
```

---

## M0: 基础框架搭建

**时间：Week 0 ~ Week 2 (2周)**

### 🎯 目标
建立项目基础架构，实现数据流闭环，能够完成最简单的分类标注。

### 📦 交付范围

#### 后端 (FastAPI)
- [x] 项目脚手架 (目录结构、配置管理、日志)
- [x] 数据库模型 (Project, Dataset, Image, Annotation)
- [x] 基础 CRUD API
  - `POST/GET/PUT/DELETE /projects`
  - `POST/GET /datasets`
  - `GET /images` (分页)
  - `POST/GET /annotations`
- [x] 文件上传接口 (单文件/批量)
- [x] 缩略图生成服务 (Pillow, 200x200, WebP)
- [x] 基础认证 (JWT)

#### 前端 (React)
- [x] 项目脚手架 (Vite + React + TypeScript)
- [x] 路由配置 (React Router)
- [x] 全局状态管理 (Zustand)
- [x] API 层封装 (Axios + React Query)
- [x] UI 组件库集成 (Ant Design)
- [x] 基础布局 (Header, Sidebar, Content)
- [x] 项目列表页
- [x] 数据集页 (简单网格，非虚拟列表)
- [x] 最简标注页 (图片展示 + 分类选择)

#### DevOps
- [x] Docker Compose 开发环境
- [x] Makefile 常用命令
- [x] README 快速启动指南

### ✅ 验收标准

| 验收项 | 标准 |
|--------|------|
| 项目创建 | 可创建项目，选择类型（分类） |
| 数据导入 | 可上传图片文件夹，显示在数据集中 |
| 基础标注 | 可查看图片，选择分类标签，提交 |
| 进度显示 | 显示已标/待标数量 |
| 部署运行 | `docker-compose up` 一键启动 |

### ⚠️ 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 技术栈不熟悉 | 中 | 中 | 优先验证关键技术点；准备备选方案 |
| 数据库设计返工 | 高 | 低 | 仔细评审 ER 图；预留扩展字段 |
| 环境配置问题 | 低 | 中 | Docker 标准化；文档详细 |

### 📊 Definition of Done
- [ ] 所有 API 端点可通过 Swagger UI 测试
- [ ] 前端可完成完整的分类标注流程
- [ ] 代码通过 Lint 检查
- [ ] 核心功能有基础测试覆盖

---

## M1: 核心标注功能

**时间：Week 2 ~ Week 4 (2周)**

### 🎯 目标
实现检测(BBox)和分割(Polygon)标注功能，建立画布交互基础，支持快捷键操作。

### 📦 交付范围

#### 画布引擎
- [x] Fabric.js 集成与封装
- [x] 画布基础功能
  - 图片加载与渲染
  - 缩放 (滚轮)
  - 平移 (空格+拖拽)
  - 重置视图 (双击)
- [x] 矩形工具 (BBox)
  - 拖拽绘制
  - 选中移动
  - 八方向调整大小
  - 删除
- [x] 多边形工具 (Polygon)
  - 点击添加顶点
  - 双击/回车闭合
  - 顶点编辑 (拖拽移动)
  - 添加/删除顶点
- [x] 标注属性
  - 类别选择
  - 属性面板 (遮挡/截断等)

#### 快捷键系统
- [x] 快捷键管理器
  - 全局快捷键注册
  - 上下文感知 (画布/表单)
  - 冲突检测
- [x] 已实现快捷键
  - `V` 选择工具
  - `R` 矩形工具
  - `P` 多边形工具
  - `1-9` 快速选类别
  - `Delete` 删除选中
  - `Ctrl+Z` 撤销
  - `Ctrl+Y` 重做
  - `Enter` 提交下一张
  - `S` 跳过
  - `?` 显示帮助
- [x] 快捷键提示 UI
  - 侧边栏常驻提示
  - `?` 键弹出完整列表

#### Undo/Redo 系统
- [x] 操作历史栈 (容量 50)
- [x] 支持操作类型
  - 创建标注
  - 删除标注
  - 移动标注
  - 调整大小
  - 更改类别
  - 批量操作
- [x] 历史状态序列化/反序列化

#### 标注流程
- [x] 跳过功能 (必填原因)
- [x] 上一张/下一张导航
- [x] 进度条显示
- [x] 自动保存草稿 (localStorage)

### ✅ 验收标准

| 验收项 | 标准 |
|--------|------|
| BBox 标注 | 可绘制、编辑、删除矩形框 |
| Polygon 标注 | 可绘制、编辑顶点、删除多边形 |
| 快捷键 | 核心操作可纯键盘完成 |
| Undo/Redo | ≥20步撤销/重做正常工作 |
| 跳过流程 | 跳过时必填原因，可取消跳过 |
| 导航 | 上下张切换，键盘操作 |

### ⚠️ 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| Canvas 性能问题 | 高 | 中 | 大图使用分块加载；限制画布尺寸 |
| Polygon 交互复杂 | 中 | 中 | 参考成熟产品交互；用户测试 |
| Undo/Redo 状态复杂 | 中 | 中 | Command 模式；单元测试覆盖 |
| 快捷键冲突 | 低 | 中 | 上下文隔离；可自定义键位 |

### 📊 Definition of Done
- [ ] 三种标注类型可完整操作
- [ ] 快捷键覆盖所有核心操作
- [ ] Undo/Redo 通过边界测试
- [ ] 无内存泄漏 (Chrome DevTools 验证)

---

## M2: 效率优化与预标注

**时间：Week 4 ~ Week 7 (3周)**

### 🎯 目标
解决慢网络环境下的体验问题，实现预标注导入，大幅提升标注效率。

### 📦 交付范围

#### 慢网优化

**缩略图服务优化**
- [x] 服务端缩略图预生成 (导入时异步生成)
- [x] WebP 格式输出
- [x] HTTP 缓存头 (ETag, Cache-Control)
- [x] Nginx 静态文件服务 (可选)

**前端预取与缓存**
- [x] 虚拟列表 (react-virtualized / @tanstack/virtual)
  - 数据集页支持 10000+ 图片
  - 仅渲染可视区域
  - 滚动性能 60fps
- [x] 图片预取策略
  - 当前图片加载后，预取后续 3 张
  - 使用 `<link rel="prefetch">` 或 Image 对象
  - 带宽感知 (navigator.connection)
- [x] IndexedDB 缓存
  - 缓存已加载图片 (Blob)
  - LRU 淘汰策略
  - 容量限制 200MB
- [x] 骨架屏与加载状态
  - 列表骨架屏
  - 图片加载占位符 (LQIP)
  - 进度指示器

**乐观更新**
- [x] 本地状态优先
- [x] 后台批量同步 (防抖 1s)
- [x] 冲突提示 (乐观锁 version 字段)

#### 预标注导入

**格式支持**
- [x] COCO JSON
  - 解析 annotations, categories
  - images 路径匹配
- [x] YOLO TXT
  - `class x_center y_center width height`
  - 归一化坐标转换
- [x] Pascal VOC XML
  - 解析 `<object>` 标签
  - 坐标转换

**导入流程**
- [x] 上传预标注文件
- [x] 格式自动检测
- [x] 标签映射界面
  - 自动匹配同名标签
  - 手动映射未识别标签
  - 创建新标签选项
- [x] 置信度过滤 (可选阈值)
- [x] 预览确认 (随机 10 张样例)
- [x] 冲突处理选项 (覆盖/跳过/合并)
- [x] 导入进度显示

**预标注展示与采纳**
- [x] 预标注特殊样式 (虚线边框/透明填充)
- [x] 操作按钮
  - 采纳当前 (A)
  - 采纳全部 (Shift+A)
  - 编辑后采纳
  - 拒绝 (删除)
- [x] 采纳统计追踪

#### 数据导出

**格式支持**
- [x] COCO JSON
- [x] YOLO TXT + classes.txt
- [x] Pascal VOC XML

**导出选项**
- [x] 筛选条件 (状态/日期/标签)
- [x] 图片包含选项 (仅标注/含图片)
- [x] 异步导出 (后台生成 ZIP)
- [x] 下载链接通知

### ✅ 验收标准

| 验收项 | 标准 |
|--------|------|
| 虚拟列表 | 10000 张图片流畅滚动 (>30fps) |
| 图片切换 | 下一张感知延迟 < 300ms (预取命中) |
| 骨架屏 | 无白屏闪烁 |
| COCO 导入 | 正确解析并显示预标注 |
| YOLO 导入 | 坐标转换正确 |
| 预标注采纳 | 一键采纳，快捷键可用 |
| 数据导出 | 三种格式导出正确 |

### ⚠️ 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| IndexedDB 兼容性 | 中 | 低 | 降级为内存缓存；检测支持 |
| 预取过度消耗带宽 | 中 | 中 | 带宽检测；用户可配置 |
| 大文件导入 OOM | 高 | 中 | 流式解析；分批处理 |
| 坐标转换精度 | 中 | 低 | 单元测试；边界验证 |

### 📊 Definition of Done
- [ ] 慢网 (模拟 3G) 下可正常标注
- [ ] 预标注导入三种格式测试通过
- [ ] 预取命中率监控可用
- [ ] 导出文件可被主流框架读取

---

## M3: 统计、导出与完善

**时间：Week 7 ~ Week 9 (2周)**

### 🎯 目标
完善效率统计 Dashboard，优化用户体验细节，准备正式发布。

### 📦 交付范围

#### 效率统计 Dashboard

**项目级统计**
- [x] 总体进度
  - 完成率饼图
  - 状态分布 (待标/进行中/已完成/跳过)
- [x] 效率指标卡片
  - 平均标注耗时
  - 预标注采纳率
  - 跳过率
  - 日吞吐量
- [x] 趋势图表
  - 每日完成数趋势 (折线图)
  - 累计进度 (面积图)
- [x] 类别分布
  - 各类别标注数量 (柱状图)
  - 类别占比 (饼图)

**标注员统计** (管理员可见)
- [x] 个人效率排名
- [x] 人均耗时对比
- [x] 贡献度统计

**数据计算**
- [x] 后端统计 API
  - `/stats/overview` 总览
  - `/stats/daily` 每日明细
  - `/stats/annotators` 标注员统计
- [x] 定时聚合任务 (可选，大数据量时)
- [x] 数据导出 (CSV)

#### 用户体验完善

**标注页优化**
- [x] 图片调整
  - 亮度/对比度滑块
  - 旋转 (90°)
  - 水平/垂直翻转
- [x] 标注图层管理
  - 显示/隐藏
  - 锁定/解锁
  - 上移/下移
- [x] 标注列表
  - 点击定位
  - 快速编辑类别
  - 批量删除

**全局体验**
- [x] 深色模式支持
- [x] 响应式布局优化 (平板适配)
- [x] 错误提示优化 (Toast + 重试)
- [x] 加载状态统一
- [x] 空状态设计

**设置页面**
- [x] 标签模板管理
  - 创建/编辑/删除
  - 颜色选择
  - 快捷键映射
- [x] 快捷键自定义
  - 查看当前键位
  - 自定义映射
  - 重置默认
- [x] 显示偏好
  - 主题切换
  - 列表/网格视图
  - 缩略图大小

#### 发布准备

**文档**
- [x] 用户指南 (使用说明)
- [x] 部署文档 (Docker / 手动)
- [x] API 文档 (自动生成 + 补充)
- [x] 开发文档 (架构说明)

**质量保障**
- [x] E2E 测试 (Playwright)
  - 核心流程覆盖
  - 跨浏览器测试
- [x] 性能测试
  - Lighthouse 评分 >80
  - 慢网模拟测试
- [x] 安全检查
  - 依赖漏洞扫描
  - 基础渗透测试

**部署**
- [x] 生产 Docker 镜像
- [x] docker-compose.prod.yml
- [x] 环境变量文档
- [x] 数据备份脚本

### ✅ 验收标准

| 验收项 | 标准 |
|--------|------|
| Dashboard | 显示所有效率 KPI，数据准确 |
| 深色模式 | 全站支持，无样式问题 |
| 设置页 | 快捷键可自定义并生效 |
| 文档 | 新用户可依据文档完成部署和使用 |
| 性能 | Lighthouse 性能 >80, 可访问性 >90 |
| E2E | 核心流程测试通过率 100% |

### ⚠️ 风险与缓解

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 统计性能问题 | 中 | 中 | 预聚合；分页；缓存 |
| 深色模式遗漏 | 低 | 高 | CSS 变量统一；全站检查 |
| 文档不完整 | 中 | 中 | 模板驱动；Review |
| 上线 Bug | 高 | 中 | 充分测试；灰度发布 |

### 📊 Definition of Done
- [ ] Dashboard 所有指标显示正确
- [ ] 设置功能完整可用
- [ ] 文档齐全，新人可独立使用
- [ ] E2E 测试覆盖核心流程
- [ ] 安全扫描无高危漏洞
- [ ] 生产部署脚本验证通过

---

## 效率 KPI 追踪

### 指标定义与目标

| 指标 | 定义 | 计算方式 | v1 目标 |
|------|------|----------|---------|
| **平均标注耗时 (ATT)** | 单张图片从进入到提交的时间 | `avg(submit_time - start_time)` | 分类<10s; 检测<60s; 分割<120s |
| **预标注采纳率 (PAR)** | 直接采纳预标注的比例 | `count(adopted) / count(has_pre)` | >60% |
| **预标注修改率 (PMR)** | 采纳后修改的比例 | `count(modified_after_adopt) / count(adopted)` | <30% |
| **跳过率 (SR)** | 被跳过图片比例 | `count(skipped) / count(total)` | <5% |
| **日人均吞吐量 (DPT)** | 每人每日完成量 | `daily_completed / active_annotators` | 分类>500; 检测>200; 分割>100 |
| **等待时间占比 (WTR)** | 等待加载时间占比 | `sum(wait_time) / sum(total_time)` | <10% |

### 数据采集方案

```javascript
// 前端埋点示例
const trackAnnotation = {
  // 开始标注
  onStart: (imageId) => {
    track('annotation_start', {
      image_id: imageId,
      timestamp: Date.now(),
    });
  },
  
  // 提交标注
  onSubmit: (imageId, annotations, source) => {
    track('annotation_submit', {
      image_id: imageId,
      timestamp: Date.now(),
      annotation_count: annotations.length,
      pre_annotation_adopted: source === 'pre',
      pre_annotation_modified: source === 'pre_modified',
    });
  },
  
  // 图片加载
  onImageLoad: (imageId, duration, fromCache) => {
    track('image_load', {
      image_id: imageId,
      duration_ms: duration,
      from_cache: fromCache,
    });
  },
};
```

### Dashboard 展示

```
┌─────────────────────────────────────────────────────────────────┐
│                     📊 效率仪表盘 - 项目 A                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐   │
│  │ 平均耗时   │  │ 采纳率    │  │ 跳过率    │  │ 日吞吐    │   │
│  │   45s     │  │   72%     │  │   3.2%    │  │  180张    │   │
│  │   ✓ 达标  │  │   ✓ 达标  │  │   ✓ 达标  │  │   ○ 接近  │   │
│  │   ↓12%    │  │   ↑5%     │  │   ↓0.8%   │  │   ↑15%    │   │
│  └───────────┘  └───────────┘  └───────────┘  └───────────┘   │
│                                                                 │
│  今日完成趋势                      标注员效率排名                  │
│  250│      ●●●                     1. 张三 - 220张 - 38s        │
│  200│    ●●   ●●                   2. 李四 - 195张 - 42s        │
│  150│  ●●       ●                  3. 王五 - 168张 - 51s        │
│  100│●●                            4. 赵六 - 145张 - 55s        │
│   50│                              5. 钱七 - 132张 - 58s        │
│     └─────────────                                              │
│      9  10  11  12  13  14  15                                  │
│                                                                 │
│  类别分布                          等待时间分析                   │
│  [██████████████] 猫  420 (42%)    加载等待: 8%  ✓              │
│  [██████████    ] 狗  312 (31%)    网络延迟: 5%  ✓              │
│  [████          ] 鸟  168 (17%)    渲染等待: 2%  ✓              │
│  [██            ] 其他 100 (10%)                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 版本对照表

| 功能 | M0 | M1 | M2 | M3 | v1.1 | v2 |
|------|----|----|----|----|------|-----|
| 分类标注 | ✓ | | | | | |
| 检测标注 (BBox) | | ✓ | | | | |
| 分割标注 (Polygon) | | ✓ | | | | |
| 分割标注 (Mask) | | | | | ✓ | |
| 快捷键系统 | | ✓ | | | | |
| Undo/Redo | | ✓ | | | | |
| 虚拟列表 | | | ✓ | | | |
| 图片预取 | | | ✓ | | | |
| IndexedDB 缓存 | | | ✓ | | | |
| 骨架屏 | | | ✓ | | | |
| 预标注导入 | | | ✓ | | | |
| 数据导出 | | | ✓ | | | |
| 效率 Dashboard | | | | ✓ | | |
| 深色模式 | | | | ✓ | | |
| 设置页面 | | | | ✓ | | |
| 离线标注 | | | | | ✓ | |
| 审阅工作流 | | | | | | ✓ |
| 多人协作 | | | | | | ✓ |
| AI 辅助 (SAM) | | | | | | ✓ |

---

## 团队建议

### 最小团队配置 (2-3人)

| 角色 | 职责 | 建议人数 |
|------|------|----------|
| 全栈开发 | 前后端开发 | 1-2 |
| 前端开发 | 画布/交互/性能 | 1 |

### 技能要求

**必须：**
- React + TypeScript
- Python + FastAPI
- Canvas / Fabric.js
- SQL (PostgreSQL)

**加分：**
- 性能优化经验
- 标注工具使用经验
- 计算机视觉背景

---

## 附录：检查清单

### M0 Checklist
- [ ] 后端项目初始化完成
- [ ] 数据库 Schema 设计评审通过
- [ ] API 端点实现并测试
- [ ] 前端项目初始化完成
- [ ] 基础页面布局完成
- [ ] 分类标注流程可用
- [ ] Docker 环境可用

### M1 Checklist
- [ ] Fabric.js 画布集成
- [ ] BBox 工具完整可用
- [ ] Polygon 工具完整可用
- [ ] 快捷键系统可用
- [ ] Undo/Redo 系统可用
- [ ] 无内存泄漏

### M2 Checklist
- [ ] 虚拟列表实现
- [ ] 预取策略实现
- [ ] IndexedDB 缓存实现
- [ ] 骨架屏实现
- [ ] COCO 导入可用
- [ ] YOLO 导入可用
- [ ] VOC 导入可用
- [ ] 三种格式导出可用

### M3 Checklist
- [ ] Dashboard 完成
- [ ] 深色模式完成
- [ ] 设置页面完成
- [ ] 用户文档完成
- [ ] 部署文档完成
- [ ] E2E 测试通过
- [ ] 性能测试通过
- [ ] 安全检查通过
- [ ] 生产环境部署成功
